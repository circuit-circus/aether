var question_pot_position,planet_pot_position,programState=1,RESET_TIME=3e4,programInactive=!1,terminalCounter=0,NO_OF_PLANETS=8,planets=[],planetData=[{name:"JSPR92",diameter:randomIntFromInterval(70,110),id:0},{name:"TX9600",diameter:randomIntFromInterval(70,110),id:1},{name:"VSOVS-io 8",diameter:randomIntFromInterval(70,110),id:2},{name:"NN-05",diameter:randomIntFromInterval(70,110),id:3},{name:"CRCTCRCS2015x",diameter:randomIntFromInterval(70,110),id:4},{name:"Mediacom",diameter:randomIntFromInterval(70,110),id:5},{name:"GroupM",diameter:randomIntFromInterval(70,110),id:6},{name:"m6",diameter:randomIntFromInterval(70,110),id:7}],showPlanetNames=!1;function setup(){createCanvas(1e3,400).parent("planet-container"),fill(0),stroke(255),textFont("Noto Mono");for(var t=0;t<NO_OF_PLANETS;t++){var e=125*t+((125-planetData[t].diameter)/2+planetData[t].diameter/2);planets[t]=new Planet(e,200,planetData[t].diameter,planetData[t].name,planetData[t].id)}updateConnectedPlanets()}function draw(){background(0),planets.forEach(function(t){t.display()})}function Planet(t,e,n,a,o){this.x=t,this.y=e,this.diameter=n,this.name=a,this.id=o,this.isConnectionActive=!0,this.hasFocus=!1,this.theta=random(PI/10),this.dtheta=random(.01,.1),this.display=function(){if(this.hasFocus&&!this.isConnectionActive)strokeWeight(2),stroke(100),fill(100),ellipse(this.x,this.y,this.diameter,this.diameter);else if(this.hasFocus){strokeWeight(3),stroke(255),fill(255),this.theta+=this.dtheta;var t=this.diameter+this.diameter*(sin(this.theta)+1)/10;ellipse(this.x,this.y,t,t)}else this.isConnectionActive?(strokeWeight(2),fill(0),stroke(255),ellipse(this.x,this.y,this.diameter,this.diameter)):(strokeWeight(2),fill(0),stroke(100),ellipse(this.x,this.y,this.diameter,this.diameter));showPlanetNames&&(textAlign(CENTER),fill(255),noStroke(),this.isConnectionActive||(fill(100),text("Unavailable",this.x,325)),text(this.name,this.x,300))},this.setConnectionIsActive=function(){this.isConnectionActive=!0},this.removeConnectionIsActive=function(){this.isConnectionActive=!1},this.setFocus=function(){this.hasFocus=!0},this.removeFocus=function(){this.hasFocus=!1}}function changeToState2(){programState=2,$("main").attr("data-state",2),$("#question-input-field").focus()}function changeToState3(t,e){programState=3,$("main").attr("data-state",3),planets[randomIntFromInterval(1,NO_OF_PLANETS-2)].setFocus(),showPlanetNames=!0,$("#asking-question-container").text(t+" "+e+"?")}function changeToState4(t){programState=4,$("main").attr("data-state",4);var e={question:$("#asking-question-container").text(),planetName:planetData[t].name,planetId:t};fetch("/api/activateTransmission",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(req_status).then(req_json).then(function(t){console.log("Request succeeded with JSON response",t)}).catch(function(t){console.log("Request failed",t)}),setTimeout(function(){runState4()},1e3)}function runState2(t){if([8,9,13,16,32,37,38,39,40,186,222,219,189].indexOf(t.which)>-1||t.which>=48&&t.which<=57||t.which>=65&&t.which<=90){if(38==t.which?(t.preventDefault(),$("#question-starter-rotator").animate({top:"+=50px"}),$("#question-starter-rotator .focus").removeClass("focus").prev().addClass("focus")):40!=t.which&&9!=t.which||(t.preventDefault(),$("#question-starter-rotator").animate({top:"-=50px"}),$("#question-starter-rotator .focus").removeClass("focus").next().addClass("focus")),13==t.which){var e=$("#question-input-field").val().trim();if(!e||0===e.length)return new Audio("sound/error.mp3").play(),void $("#missing-input").show().addClass("popup-open");changeToState3($("#question-starter-rotator .focus").text(),e)}}else t.preventDefault(),console.log("not one of those")}function runState3(t){if(t.preventDefault(),t.which>=49&&t.which<=56){for(var e=0;e<NO_OF_PLANETS;e++)planets[e].removeFocus();var n=t.which-49;planets[n].setFocus()}else if(13==t.which)for(e=0;e<NO_OF_PLANETS;e++)if(planets[e].hasFocus){if(console.log("Planet number %i, %s, has focus",e,planets[e].name),!planets[e].isConnectionActive)return new Audio("sound/error.mp3").play(),void $("#unavailable-planet").show().addClass("popup-open");changeToState4(e)}}function runState4(){runTerminalGUI()}function resetProgram(){programState=1,showPlanetNames=!1;for(var t=0;t<NO_OF_PLANETS;t++)planets[t].removeFocus();terminalCounter=0,$("#question-input-field").val(""),$("#terminal-content").html(""),$(".terminal-new-content #terminal-typing").html(""),$("main").attr("data-state",1)}$(document).ready(function(){window.WebSocket=window.WebSocket||window.MozWebSocket,new WebSocket("ws://localhost:8080").onmessage=function(t){console.log(t.data);var e=t.data;e.includes("QUESTION_POT")?question_pot_position=e.substring(e.indexOf(" "),e.length).trim():e.includes("PLANET_POT")&&(planet_pot_position=e.substring(e.indexOf(" "),e.length).trim())},setInterval(resetProgramTimer,RESET_TIME),$("body").on("keydown",function(t){if(programInactive=!1,$(".popup-container").hasClass("popup-open"))return t.preventDefault(),void $(".popup-container.popup-open").hide().removeClass("popup-open");1==programState?(t.preventDefault(),changeToState2(t)):2==programState?runState2(t):3==programState&&runState3(t)})});var terminalStrings=[{strings:["","Loading","Loading.","Loading..","Loading...","Loading","Loading.","Loading..","Loading...","Loading complete"],smartBackspace:!0,typeSpeed:200},{strings:["","Initializing transmission"],smartBackspace:!1,typeSpeed:40},{strings:["","npm install^1000\n `installing components...` ^1000\n `Fetching from source...`"],smartBackspace:!1,typeSpeed:40},{strings:["","Transmission COMPLETE"],smartBackspace:!1,typeSpeed:40},{strings:["",".","..","..."],smartBackspace:!0,typeSpeed:40}];function runTerminalGUI(){if(4==programState){var t={strings:terminalStrings[terminalCounter].strings,typeSpeed:40,smartBackspace:terminalStrings[terminalCounter].smartBackspace,showCursor:!1,onComplete:t=>{if(terminalCounter<terminalStrings.length-1){var e=$(".terminal-new-content").clone().removeClass("terminal-new-content").addClass("terminal-content-line");$("#terminal-content").append(e),$(".terminal-new-content #terminal-typing").html(""),terminalCounter++,runTerminalGUI()}}};new Typed(".terminal-new-content #terminal-typing ",t)}}function updateConnectedPlanets(){fetch("/api/currentArduinoClients").then(req_status).then(req_json).then(function(t){console.log("Request succeeded with JSON response",t);var e=t.message;planets.filter(function(t){return!e.some(function(e){return t.id===e.id})}).forEach(function(t){t.removeConnectionIsActive()})}).catch(function(t){console.log("Request failed",t)})}function resetProgramTimer(){if((1!=programState||4!=programState)&&programInactive)return resetProgram(),void(programInactive=!1);programInactive=!0}function randomIntFromInterval(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function req_status(t){return console.log("Determining status"),console.log(t.status),t.status>=200&&t.status<300?Promise.resolve(t):Promise.reject(new Error(t.statusText))}function req_json(t){return console.log("Process response json"),t.json()}