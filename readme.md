# aether ðŸš€ âœ¨

Code for aether installation by Circuit Circus
This code is divied into a _server_ part, an _arduino_ part and a _python_ part.

The server manages the interface, and can broadcast messages to all connected arduino (MKR1000) clients. The arduinos themselves keep track of whether the message was directed at them, or should be ignored. The python takes care of two main tasks: generating text from a trained neural network, and printing out receipts to the user.

### Server
The server runs on Node.js and creates a websocket for communicating with the arduinos. Furthermore, it manages the interface that users will interact with.

It uses the _ws_ module for the socket, _express_ for routing etc. and _ejs_ as the view engine.

To install, go to the server_websocket directory and run ```npm install ```. 
Then you can run ```npm start``` and the server will be running. Navigate to ```localhost:3000``` to see the frontend.


### Arduino
Each Arduino (MKR1000) connects to the websocket on the server. They each have an ID and will use this to determine whether or not a signal broadcasted by the server is directed at them. 

The ```config.h``` file with wifi information is ignored and should be maintained locally. 

We use this library: https://github.com/arduino-libraries/ArduinoHttpClient

### Python

#### Text generation

For this to work, you need the following installed: Python3 and Tensorflow v. 0.11.0. To install those, you need Python3's package manger _pip3_.

##### Installing on Mac

For Mac's, you can install Python3 via Homebrew: 

`brew install python3`

pip3 is installed when running this command:

`brew postinstall python3`

Installing tensorflow directly via pip3 won't work, since the oldest version available on there is v. 0.12.1. So, we need to customize the example given on Tensorflow's [website](https://www.tensorflow.org/versions/r0.12/get_started/os_setup#pip_installation).

Instead of: `sudo pip3 install --upgrade https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.12.1-py3-none-any.whl`, we should run: `sudo pip3 install --upgrade https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-0.11.0-py3-none-any.whl`

When this is done, you should be ready to run the text generation. Do this by calling `python3 rnn_play.py`.

##### Installing on Raspberry Pi with Raspbian

For the Raspberry Pi, Python3 should be pre-installed, so you just need to install pip3:

`sudo apt-get install python3-pip`

Raspbian's newest available version of Tensorflow is v. 0.11.0, so there should be no trouble here. Just install it by calling:
`sudo pip3 install tensorflow`

You might get an error like this: 
```Traceback (most recent call last):
  File "/home/pi/.local/lib/python3.5/site-packages/numpy/core/__init__.py", line 16, in <module>
    from . import multiarray
ImportError: libf77blas.so.3: cannot open shared object file: No such file or directory
```

In this case, you need to run the following: `sudo apt-get install libatlas-base-dev`

The Neural Network code is drawn from [this repo](https://github.com/burliEnterprises/tensorflow-shakespeare-poem-generator). There are tiny modifications here and there. 

#### Printing

When you want to print something, first be sure to wire up the printer as described by [Adafruit](https://learn.adafruit.com/networked-thermal-printer-using-cups-and-raspberry-pi/connect-and-configure-printer).

Printing does not work in Python3 at the moment, so you have to use Python2 for this part. Strange, right? It should be pre-installed on both Mac and Raspberry Pi.

`rnn_print.py` is called from the server automatically, and prints out a receipt with the given planet name, question text and some answer text as generated by `rnn_play.py`. But you can also run it directly with your own arguments passed to it. 

The formula for passing arguments is: `python rnn_print.py "YOURQUESTION" "PLANETNAME" "YOURANSWER"`

For example: `python rnn_print.py "Will I be happy in this lifetime?" "JSPR-92" "The man was a single more to see the party."`. 